# åŒ…ç®¡ç†å™¨è¦ç‚¹é€Ÿè®°

## NPM / Yarn / PNPM æ¦‚è§ˆ
- NPMï¼šé»˜è®¤æœ€å…¼å®¹ã€ç”Ÿæ€æœ€å¤§ï¼›é€Ÿåº¦ä¸ç£ç›˜å ç”¨æœ€é€Šã€‚
- Yarnï¼šä½“éªŒå¥½ã€å¹¶è¡Œå®‰è£…å¿«ã€Workspaces æˆç†Ÿï¼›Classic/Berry ç‰ˆæœ¬å‰²è£‚ã€‚
- PNPMï¼šç¼“å­˜å®‰è£…æœ€å¿«ã€æœ€çœç©ºé—´ï¼ˆå…¨å±€å­˜å‚¨+ç¡¬é“¾ï¼‰ï¼›ä¸¥æ ¼ç¦æ­¢å¹½çµä¾èµ–ï¼ŒMonorepo ä½“éªŒæœ€ä½³ã€‚

## æ€§èƒ½ä¸ç©ºé—´
- é¦–æ¬¡å®‰è£…ï¼špnpm â‰ˆ yarn > npmï¼›çƒ­ç¼“å­˜å®‰è£… pnpm é¢†å…ˆï¼ˆç¡¬é“¾æ¥å‡ ä¹ç§’è£…ï¼‰ã€‚
- å•é¡¹ç›® node_modules ä½“ç§¯ç›¸è¿‘ï¼Œä½†å¤šé¡¹ç›®æ—¶ pnpm å…±äº«å…¨å±€ storeï¼Œå¯çœçº¦ 60-70% ç£ç›˜ã€‚
- CI ç¼“å­˜ï¼špnpm å‘½ä¸­ç‡å’Œæ¢å¤é€Ÿåº¦æœ€ä½³ï¼Œç»“åˆ `~/.pnpm-store` ç¼“å­˜ã€‚

## PNPM æœºåˆ¶ï¼ˆç¤ºä¾‹ï¼šproject/node_modules/.pnpm/lodash@4.17.21/node_modules/lodashï¼‰
- å…¨å±€ store çœŸå®åŒ…ï¼ˆé»˜è®¤ macOS è·¯å¾„ `~/Library/pnpm/store/v3`ï¼Œå¯ç”¨ `pnpm store path` æŸ¥çœ‹ï¼‰ã€‚
- `.pnpm/*/node_modules/<pkg>` å†…çš„æ–‡ä»¶å¤šä¸ºç¡¬é“¾æ¥æŒ‡å‘å…¨å±€ storeã€‚
- é¡¶å±‚ `node_modules/<pkg>` é€šå¸¸æ˜¯æŒ‡å‘ `.pnpm/.../node_modules/<pkg>` çš„ç¬¦å·é“¾æ¥ï¼›ç›®å½•ç»“æ„ç”¨è½¯é“¾ï¼Œæ–‡ä»¶æœ¬ä½“ç”¨ç¡¬é“¾å¤ç”¨ storeã€‚
- è‹¥æ–‡ä»¶ç³»ç»Ÿä¸æ”¯æŒç¡¬é“¾/è½¯é“¾ï¼Œpnpm ä¼šå›é€€ä¸ºç¬¦å·é“¾æ¥ã€‚

## Linux ç¡¬é“¾æ¥ vs ç¬¦å·é“¾æ¥ï¼ˆè½¯é“¾æ¥ï¼‰

### ç¡¬é“¾æ¥ (Hard Link)

**æ¦‚å¿µ**ï¼šå¤šä¸ªæ–‡ä»¶åæŒ‡å‘åŒä¸€ä¸ª inodeï¼ˆæ–‡ä»¶çš„å®é™…æ•°æ®å—ï¼‰

**åˆ›å»ºå‘½ä»¤**ï¼š
```bash
ln source_file hard_link
```

**ç‰¹ç‚¹**ï¼š
- âœ… æŒ‡å‘åŒä¸€ä¸ª inodeï¼Œå…±äº«æ–‡ä»¶å†…å®¹
- âœ… åˆ é™¤åŸæ–‡ä»¶ï¼Œç¡¬é“¾æ¥ä»ç„¶æœ‰æ•ˆï¼ˆåªè¦è¿˜æœ‰ä¸€ä¸ªé“¾æ¥å­˜åœ¨ï¼Œæ•°æ®å°±ä¸ä¼šä¸¢å¤±ï¼‰
- âœ… å ç”¨ç©ºé—´ï¼šå‡ ä¹ä¸º 0ï¼ˆåªå¢åŠ ä¸€ä¸ªç›®å½•é¡¹ï¼‰
- âœ… ä¿®æ”¹ä»»ä¸€é“¾æ¥ï¼Œæ‰€æœ‰é“¾æ¥éƒ½ä¼šåŒæ­¥æ›´æ–°ï¼ˆå®ƒä»¬æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ï¼‰
- âŒ ä¸èƒ½è·¨æ–‡ä»¶ç³»ç»Ÿ/åˆ†åŒº
- âŒ ä¸èƒ½é“¾æ¥ç›®å½•ï¼ˆé˜²æ­¢å¾ªç¯å¼•ç”¨ï¼‰
- âŒ å¿…é¡»æ˜¯åŒä¸€æ–‡ä»¶ç³»ç»Ÿ

**æŸ¥çœ‹ç¡¬é“¾æ¥æ•°**ï¼š
```bash
ls -li  # i æ˜¾ç¤º inode å·ï¼Œl æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
# ç¬¬äºŒåˆ—æ•°å­—å°±æ˜¯ç¡¬é“¾æ¥è®¡æ•°
```

**ç¤ºä¾‹**ï¼š
```bash
# åˆ›å»ºåŸæ–‡ä»¶
echo "Hello" > original.txt

# åˆ›å»ºç¡¬é“¾æ¥
ln original.txt hardlink.txt

# æŸ¥çœ‹ inodeï¼ˆä¸¤ä¸ªæ–‡ä»¶ inode å·ç›¸åŒï¼‰
ls -li
# 12345678 -rw-r--r-- 2 user group 6 Dec  3 10:00 original.txt
# 12345678 -rw-r--r-- 2 user group 6 Dec  3 10:00 hardlink.txt
#    â†‘ ç›¸åŒçš„ inode å·

# åˆ é™¤åŸæ–‡ä»¶
rm original.txt

# hardlink.txt ä»ç„¶å­˜åœ¨ä¸”å†…å®¹å®Œæ•´
cat hardlink.txt  # è¾“å‡º: Hello

# ç£ç›˜ç©ºé—´ï¼šåªå ç”¨ä¸€ä»½
du -sh original.txt hardlink.txt  # æ€»å…±åªæœ‰ä¸€ä»½æ•°æ®
```

### ç¬¦å·é“¾æ¥ (Symbolic Link / Soft Link)

**æ¦‚å¿µ**ï¼šåˆ›å»ºä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶ï¼Œå†…å®¹æ˜¯æŒ‡å‘ç›®æ ‡æ–‡ä»¶çš„è·¯å¾„

**åˆ›å»ºå‘½ä»¤**ï¼š
```bash
ln -s source_file symlink
```

**ç‰¹ç‚¹**ï¼š
- âœ… å¯ä»¥è·¨æ–‡ä»¶ç³»ç»Ÿ/åˆ†åŒº
- âœ… å¯ä»¥é“¾æ¥ç›®å½•
- âœ… å¯ä»¥é“¾æ¥ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼ˆæ‚¬ç©ºé“¾æ¥ï¼‰
- âœ… æ›´çµæ´»ï¼Œç±»ä¼¼ Windows çš„å¿«æ·æ–¹å¼
- âŒ åˆ é™¤åŸæ–‡ä»¶ï¼Œç¬¦å·é“¾æ¥å¤±æ•ˆï¼ˆå˜æˆæ‚¬ç©ºé“¾æ¥ï¼‰
- âŒ å ç”¨ä¸€ç‚¹ç©ºé—´ï¼ˆå­˜å‚¨è·¯å¾„å­—ç¬¦ä¸²ï¼‰
- âŒ è®¿é—®æ—¶éœ€è¦é¢å¤–çš„è·¯å¾„è§£æï¼ˆæ€§èƒ½ç•¥å·®ï¼‰

**ç¤ºä¾‹**ï¼š
```bash
# åˆ›å»ºåŸæ–‡ä»¶
echo "Hello" > original.txt

# åˆ›å»ºç¬¦å·é“¾æ¥
ln -s original.txt symlink.txt

# æŸ¥çœ‹ï¼ˆæ³¨æ„ç®­å¤´æŒ‡å‘ï¼‰
ls -l
# lrwxr-xr-x 1 user group 12 Dec  3 10:00 symlink.txt -> original.txt
#  â†‘ l è¡¨ç¤ºæ˜¯ç¬¦å·é“¾æ¥

# åˆ é™¤åŸæ–‡ä»¶
rm original.txt

# symlink.txt å˜æˆæ‚¬ç©ºé“¾æ¥ï¼ˆçº¢è‰²é—ªçƒï¼‰
cat symlink.txt  # æŠ¥é”™: No such file or directory

# æŸ¥çœ‹ç¬¦å·é“¾æ¥æœ¬èº«ï¼ˆä¸è·Ÿéšé“¾æ¥ï¼‰
ls -l symlink.txt
# lrwxr-xr-x 1 user group 12 Dec  3 10:00 symlink.txt -> original.txt (çº¢è‰²)
```

### å¯¹æ¯”è¡¨æ ¼

| ç‰¹æ€§ | ç¡¬é“¾æ¥ | ç¬¦å·é“¾æ¥ |
|-----|--------|---------|
| **å‘½ä»¤** | `ln file link` | `ln -s file link` |
| **æœ¬è´¨** | æŒ‡å‘åŒä¸€ inode | æŒ‡å‘æ–‡ä»¶è·¯å¾„ |
| **è·¨æ–‡ä»¶ç³»ç»Ÿ** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **é“¾æ¥ç›®å½•** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **åŸæ–‡ä»¶åˆ é™¤** | âœ… ä»æœ‰æ•ˆ | âŒ å¤±æ•ˆï¼ˆæ‚¬ç©ºï¼‰ |
| **ç£ç›˜ç©ºé—´** | 0ï¼ˆå…±äº«æ•°æ®ï¼‰ | å‡  bytesï¼ˆè·¯å¾„ï¼‰ |
| **inode** | ç›¸åŒ | ä¸åŒ |
| **æ€§èƒ½** | âœ… ç›´æ¥è®¿é—® | âŒ éœ€è·¯å¾„è§£æ |
| **çµæ´»æ€§** | âŒ å—é™å¤š | âœ… æ›´çµæ´» |

### PNPM ä¸ºä»€ä¹ˆåŒæ—¶ä½¿ç”¨ä¸¤è€…ï¼Ÿ

**ç¡¬é“¾æ¥ç”¨äºæ–‡ä»¶**ï¼ˆèŠ‚çœç©ºé—´ï¼‰ï¼š
```bash
# store ä¸­çš„æ–‡ä»¶
~/.pnpm-store/v3/files/ab/cd1234.../package.json (åŸå§‹æ•°æ®)

# é¡¹ç›®ä¸­çš„ç¡¬é“¾æ¥
project/node_modules/.pnpm/lodash@4.17.21/node_modules/lodash/package.json
â†’ ç¡¬é“¾æ¥åˆ° storeï¼ŒæŒ‡å‘åŒä¸€ä¸ª inode

# ä¼˜åŠ¿ï¼šå®Œå…¨å…±äº«æ•°æ®ï¼Œé›¶é¢å¤–ç©ºé—´
```

**ç¬¦å·é“¾æ¥ç”¨äºç›®å½•**ï¼ˆç»„ç»‡ç»“æ„ï¼‰ï¼š
```bash
# é¡¶å±‚è®¿é—®
project/node_modules/lodash
â†’ ç¬¦å·é“¾æ¥æŒ‡å‘
  project/node_modules/.pnpm/lodash@4.17.21/node_modules/lodash

# ä¼˜åŠ¿ï¼šå¯ä»¥é“¾æ¥ç›®å½•ï¼Œçµæ´»ç»„ç»‡ç»“æ„
```

### å®é™…æµ‹è¯•é“¾æ¥

```bash
# æµ‹è¯•ç¡¬é“¾æ¥
echo "test" > original.txt
ln original.txt hard.txt
stat original.txt hard.txt  # æŸ¥çœ‹ inode
# Inode: 12345678 (ç›¸åŒ)

# æµ‹è¯•ç¬¦å·é“¾æ¥
ln -s original.txt soft.txt
stat soft.txt
# Inode: 87654321 (ä¸åŒ)

# æŸ¥çœ‹ç£ç›˜å ç”¨
du -sh original.txt hard.txt soft.txt
# 5B  original.txt
# 0B  hard.txt       â† ç¡¬é“¾æ¥ä¸å é¢å¤–ç©ºé—´
# 12B soft.txt       â† ç¬¦å·é“¾æ¥å ä¸€ç‚¹ç©ºé—´ï¼ˆå­˜è·¯å¾„ï¼‰

# åˆ é™¤åŸæ–‡ä»¶çœ‹æ•ˆæœ
rm original.txt
cat hard.txt  # âœ… æˆåŠŸï¼Œè¾“å‡º: test
cat soft.txt  # âŒ å¤±è´¥ï¼Œæ‚¬ç©ºé“¾æ¥
```

### PNPM ç©ºé—´èŠ‚çœåŸç†

```
å‡è®¾ lodash åŒ…å¤§å° 500KB

NPM/Yarn (3ä¸ªé¡¹ç›®):
  project1/node_modules/lodash  500KB (å¤åˆ¶)
  project2/node_modules/lodash  500KB (å¤åˆ¶)
  project3/node_modules/lodash  500KB (å¤åˆ¶)
  æ€»è®¡: 1.5MB

PNPM (3ä¸ªé¡¹ç›®):
  ~/.pnpm-store/lodash@4.17.21  500KB (åŸå§‹æ•°æ®)
  project1/node_modules/.../lodash  0KB (ç¡¬é“¾æ¥)
  project2/node_modules/.../lodash  0KB (ç¡¬é“¾æ¥)
  project3/node_modules/.../lodash  0KB (ç¡¬é“¾æ¥)
  æ€»è®¡: 500KB âœ… èŠ‚çœ 66%
```

## é€‰æ‹©å»ºè®®
- æ–°é¡¹ç›®ã€Monorepoã€å¤šé¡¹ç›®å¼€å‘ã€CI æ€§èƒ½/ç©ºé—´æ•æ„Ÿï¼šé¦–é€‰ PNPMã€‚
- å…¼å®¹æ€§æˆ–å›¢é˜Ÿä¹ æƒ¯ä¼˜å…ˆçš„è€é¡¹ç›®ï¼šä¿æŒ NPM/Yarnã€‚
- é¿å…æ··ç”¨å¤šä¸ªåŒ…ç®¡ç†å™¨ï¼›é”æ–‡ä»¶å¿…é¡»æäº¤ï¼ˆpackage-lock.json / yarn.lock / pnpm-lock.yamlï¼‰ã€‚

---

## ä¸ºä»€ä¹ˆå°é¡¹ç›®ä¸­ Yarn å¯èƒ½æ¯” PNPM æ›´å¿«ï¼Ÿ

### å®æµ‹æ¡ˆä¾‹
åœ¨åªæœ‰ 6 ä¸ªä¾èµ–çš„å° demo é¡¹ç›®ä¸­æµ‹è¯•ç¼“å­˜å®‰è£…ï¼š
- **Yarn**: 0.66s âœ…
- **PNPM**: 1.2s

Yarn æ›´å¿«ï¼è¿™ä¸"PNPM æœ€å¿«"çš„è¯´æ³•çŸ›ç›¾å—ï¼Ÿ

### åŸå› åˆ†æ

#### 1. é¡¹ç›®è§„æ¨¡å¤ªå°
å½“å‰æµ‹è¯•åªæœ‰ 6 ä¸ªä¾èµ–åŒ…ï¼ˆlodashã€expressã€axiosã€momentã€reactã€react-domï¼‰ã€‚

**PNPM çš„ä¼˜åŠ¿åœ¨ä¸­å¤§å‹é¡¹ç›®æ‰æ˜¾è‘—**ã€‚å°é¡¹ç›®ä¸­ï¼š
- åˆ›å»ºç¬¦å·é“¾æ¥çš„å¼€é”€ç›¸å¯¹æ˜æ˜¾
- Yarn çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥æ›´ç›´æ¥
- ä¾èµ–å°‘ï¼Œé“¾æ¥æœºåˆ¶çš„ä¼˜åŠ¿ä¸æ˜æ˜¾

#### 2. PNPM éœ€è¦åšæ›´å¤šå·¥ä½œ

**PNPM å®‰è£…è¿‡ç¨‹**ï¼š
```
1. æ£€æŸ¥å…¨å±€ store (~/.pnpm-store)
2. åˆ›å»º .pnpm ç›®å½•ç»“æ„
3. ä» store åˆ›å»ºç¡¬é“¾æ¥
4. åˆ›å»ºç¬¦å·é“¾æ¥åˆ°é¡¶å±‚ node_modules
5. éªŒè¯é“¾æ¥å®Œæ•´æ€§
```

**Yarn å®‰è£…è¿‡ç¨‹**ï¼š
```
1. ä»ç¼“å­˜ç›´æ¥å¤åˆ¶æ–‡ä»¶
2. è§£æä¾èµ–å…³ç³»
3. æ‰å¹³åŒ–å¤„ç†ï¼ˆç®€å•å¿«é€Ÿï¼‰
```

å¯¹äºå°é¡¹ç›®ï¼š**PNPM çš„é“¾æ¥å¼€é”€ > èŠ‚çœçš„æ—¶é—´**

#### 3. Yarn çš„ç¼“å­˜ç­–ç•¥
Yarn ç¼“å­˜å‘½ä¸­æ—¶éå¸¸æ¿€è¿›ï¼š
- ç›´æ¥ä» `~/.yarn/cache` å¤åˆ¶ï¼Œæ— éœ€é¢å¤–æ£€æŸ¥
- æ‰å¹³åŒ–ç»“æ„å¤åˆ¶æ›´ç®€å•ç›´æ¥
- å¹¶è¡Œä¼˜åŒ–å¯¹å°é¡¹ç›®æ•ˆæœå¥½

#### 4. æ–‡ä»¶ç³»ç»Ÿå½±å“
ä¸åŒæ–‡ä»¶ç³»ç»Ÿå¯¹ç¬¦å·é“¾æ¥æ€§èƒ½ä¸åŒï¼š
- **APFS (macOS)**: ç¬¦å·é“¾æ¥æ€§èƒ½è¾ƒå¥½ï¼Œä½†ä»æœ‰å¼€é”€
- **ext4 (Linux)**: ç¬¦å·é“¾æ¥æ€§èƒ½æ›´å¥½
- **NTFS (Windows)**: ç¬¦å·é“¾æ¥å¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™

### PNPM ä¼˜åŠ¿ä½•æ—¶ä½“ç°ï¼Ÿ

#### åœºæ™¯ 1ï¼šä¸­å¤§å‹é¡¹ç›®ï¼ˆ20+ ä¾èµ–ï¼‰
å…¸å‹ React é¡¹ç›®ï¼ˆå« TypeScriptã€Webpackã€ESLintã€Jest ç­‰ï¼‰

**é¢„æœŸç»“æœ**ï¼ˆç¼“å­˜å®‰è£…ï¼‰ï¼š
- Yarn: ~8-12s
- PNPM: ~2-4s âš¡ï¸

#### åœºæ™¯ 2ï¼šå¤šé¡¹ç›®åœºæ™¯ï¼ˆç£ç›˜ç©ºé—´ï¼‰
å‡è®¾ 5 ä¸ªç±»ä¼¼é¡¹ç›®ï¼š

```
Yarn (5ä¸ªé¡¹ç›®):
  å„ ~150MB node_modules
  æ€»è®¡: ~750MB

PNPM (5ä¸ªé¡¹ç›®):
  ~/.pnpm-store: ~200MB (å…¨å±€ï¼Œå…±äº«)
  å„é¡¹ç›®ç¬¦å·é“¾æ¥: ~10MB
  æ€»è®¡: ~250MB
```

**èŠ‚çœç©ºé—´ï¼š60-70%** ğŸ’¾

#### åœºæ™¯ 3ï¼šMonorepo é¡¹ç›®
PNPM çš„ workspace + filter åŠŸèƒ½å¼ºå¤§ï¼š
```bash
pnpm --filter @myapp/utils add lodash
pnpm -r run test
pnpm --filter "...@myapp/web" build
```

### æ€§èƒ½å¯¹æ¯”æ€»ç»“è¡¨

| åœºæ™¯ | Yarn | PNPM | è°æ›´å¿« |
|-----|------|------|--------|
| å°é¡¹ç›®ç¼“å­˜å®‰è£… (< 10 ä¾èµ–) | **0.6s** | 1.2s | âœ… Yarn |
| ä¸­å‹é¡¹ç›®ç¼“å­˜å®‰è£… (~30 ä¾èµ–) | 8s | **3s** | âœ… PNPM |
| å¤§å‹é¡¹ç›®ç¼“å­˜å®‰è£… (100+ ä¾èµ–) | 15s | **4s** | âœ… PNPM |
| å¤šé¡¹ç›®ç£ç›˜å ç”¨ | 750MB | **250MB** | âœ… PNPM |

### æ ¸å¿ƒç»“è®º

1. **å°é¡¹ç›®ä¸­ Yarn æ›´å¿«æ˜¯æ­£å¸¸çš„**
   - ç¬¦å·é“¾æ¥æœ‰å¼€é”€
   - ä¾èµ–å°‘ï¼Œä¼˜åŠ¿ä¸æ˜æ˜¾
   - å·®å¼‚é€šå¸¸ < 1 ç§’ï¼Œå½±å“ä¸å¤§

2. **PNPM çš„ä¼˜åŠ¿åœ¨è§„æ¨¡åŒ–**
   - ä¾èµ–è¶Šå¤šï¼Œé€Ÿåº¦è¶Šå¿«
   - é¡¹ç›®è¶Šå¤šï¼Œç©ºé—´è¶Šçœ
   - Monorepo æ”¯æŒæœ€ä½³

3. **é€‰æ‹©å·¥å…·çœ‹å®é™…éœ€æ±‚**
   - å° demo (< 10 ä¾èµ–)ï¼šYarn/NPM éƒ½å¯ä»¥
   - ä¸­å‹é¡¹ç›® (10-50 ä¾èµ–)ï¼šPNPM å¼€å§‹æ˜¾ç¤ºä¼˜åŠ¿
   - å¤§å‹é¡¹ç›® (> 50 ä¾èµ–)ï¼šPNPM å¼ºçƒˆæ¨è
   - å¤šé¡¹ç›®å¼€å‘ï¼šPNPMï¼ˆç©ºé—´ä¼˜åŠ¿å·¨å¤§ï¼‰
   - Monorepoï¼šPNPMï¼ˆæœ€ä½³æ”¯æŒï¼‰

4. **PNPM çš„æ ¸å¿ƒä»·å€¼ä¸åªæ˜¯é€Ÿåº¦**
   - âœ… ä¸¥æ ¼ä¾èµ–ç®¡ç†ï¼ˆæ— å¹½çµä¾èµ–ï¼‰
   - âœ… èŠ‚çœç£ç›˜ç©ºé—´ï¼ˆ60-70%ï¼‰
   - âœ… Monorepo åŸç”Ÿæ”¯æŒ
   - âœ… é€Ÿåº¦ä¼˜åŠ¿ï¼ˆä¸­å¤§é¡¹ç›®ï¼‰

### æœ€ç»ˆç†è§£

**æ–°é¡¹ç›®æ¨è PNPMï¼Œä¸æ˜¯å› ä¸ºå®ƒåœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½æœ€å¿«ï¼Œè€Œæ˜¯å› ä¸ºï¼š**
1. é•¿æœŸæ¥çœ‹æ›´å¿«ï¼ˆéšç€é¡¹ç›®å¢é•¿ï¼‰
2. å¤šé¡¹ç›®å¼€å‘çœç©ºé—´ï¼ˆæ˜¾è‘—ï¼‰
3. ä¾èµ–ç®¡ç†æ›´ä¸¥æ ¼ï¼ˆé¿å…éšè—é—®é¢˜ï¼‰
4. ä»£è¡¨æœªæ¥æ–¹å‘ï¼ˆVue 3ã€Viteã€Nuxt 3 ç­‰éƒ½åœ¨ç”¨ï¼‰

**å¯¹äº 6 ä¸ªä¾èµ–çš„ demoï¼ŒYarn å¿« 0.5 ç§’æ˜¯å®Œå…¨æ­£å¸¸çš„ï¼** è¿™åè€Œå¸®åŠ©ç†è§£äº†å·¥å…·çš„åº•å±‚åŸç†ã€‚ğŸ“

---

## å¹½çµä¾èµ–ï¼ˆPhantom Dependenciesï¼‰

### ä»€ä¹ˆæ˜¯å¹½çµä¾èµ–ï¼Ÿ

**å¹½çµä¾èµ–**ï¼šä»£ç ä¸­å¯ä»¥ `require/import` ä¸€ä¸ª**æœªåœ¨ package.json ä¸­å£°æ˜**çš„ä¾èµ–åŒ…ï¼Œä½†ç¨‹åºå´èƒ½æ­£å¸¸è¿è¡Œã€‚

### äº§ç”ŸåŸå› ï¼šæ‰å¹³åŒ–æœºåˆ¶

NPM v3+ å’Œ Yarn ä¸ºäº†å‡å°‘ç£ç›˜å ç”¨ï¼Œå°†ä¾èµ–"æå‡"åˆ°é¡¶å±‚ï¼š

```
# NPM v2ï¼ˆæ— å¹½çµä¾èµ–ï¼‰
node_modules/
â””â”€â”€ express/
    â””â”€â”€ node_modules/
        â””â”€â”€ cookie/        # åµŒå¥—ï¼Œæ— æ³•ç›´æ¥è®¿é—®

# NPM v3+/Yarnï¼ˆæœ‰å¹½çµä¾èµ–ï¼‰
node_modules/
â”œâ”€â”€ express/
â””â”€â”€ cookie/                # è¢«æå‡ï¼å¯ä»¥ç›´æ¥è®¿é—®
```

### å®é™…æ¡ˆä¾‹

```json
// package.json - åªå£°æ˜äº† express
{
  "dependencies": {
    "express": "^5.0.0"
  }
}
```

```javascript
// index.js
const express = require('express');  // âœ… å£°æ˜äº†
const cookie = require('cookie');    // âŒ æ²¡å£°æ˜ï¼Œä½†èƒ½ç”¨ï¼

console.log(cookie.parse('foo=bar'));  // å±…ç„¶èƒ½è¿è¡Œï¼
```

**åŸå› **ï¼šexpress ä¾èµ– cookieï¼Œcookie è¢«æå‡åˆ°é¡¶å±‚ï¼ŒNode.js èƒ½æ‰¾åˆ°ã€‚

### å¹½çµä¾èµ–çš„å±å®³

1. **éšè—çš„ä¾èµ–å…³ç³»**
   - ä¸çŸ¥é“é¡¹ç›®çœŸæ­£ä¾èµ–ä»€ä¹ˆ
   - ä»£ç å®¡æŸ¥æ—¶å®¹æ˜“é—æ¼

2. **çªç„¶å´©æºƒ**
   ```bash
   # å‡çº§ express
   express v4.18.0 ä¾èµ– cookie v0.5.0 â†’ cookie å¯ç”¨
   express v5.0.0 ä¸ä¾èµ– cookie â†’ cookie æ¶ˆå¤±ï¼Œä»£ç å´©æºƒï¼
   ```

3. **ç‰ˆæœ¬å†²çª**
   - ä¸åŒåŒ…ä¾èµ–ä¸åŒç‰ˆæœ¬
   - æå‡çš„ç‰ˆæœ¬å¯èƒ½ä¸æ˜¯ä½ éœ€è¦çš„

4. **å›¢é˜Ÿåä½œé—®é¢˜**
   - å®‰è£…é¡ºåºä¸åŒï¼Œæå‡çš„åŒ…å¯èƒ½ä¸åŒ
   - "åœ¨æˆ‘æœºå™¨ä¸Šèƒ½è¿è¡Œ"é—®é¢˜

5. **å‘å¸ƒ npm åŒ…é™·é˜±**
   - å¼€å‘æ—¶èƒ½ç”¨ï¼Œç”¨æˆ·å®‰è£…åå´©æºƒ

### PNPM å¦‚ä½•è§£å†³ï¼Ÿ

éæ‰å¹³åŒ–ç»“æ„ï¼š

```
node_modules/
â”œâ”€â”€ express -> .pnpm/express@5.0.0/node_modules/express
â””â”€â”€ .pnpm/
    â””â”€â”€ express@5.0.0/
        â””â”€â”€ node_modules/
            â”œâ”€â”€ express/
            â””â”€â”€ cookie/    # éšè—ï¼Œé¡¶å±‚è®¿é—®ä¸åˆ°
```

```javascript
const cookie = require('cookie');
// Error: Cannot find module 'cookie'
// å¿…é¡»æ˜¾å¼å£°æ˜ï¼špnpm add cookie
```

---

## NPM/Yarn/PNPM é“¾æ¥æŠ€æœ¯å¯¹æ¯”

### NPM é“¾æ¥æŠ€æœ¯

**å¸¸è§„ä¾èµ–**ï¼šâŒ ä¸ä½¿ç”¨é“¾æ¥ï¼Œ**æ–‡ä»¶å¤åˆ¶**

```
node_modules/
â”œâ”€â”€ lodash/              # å®Œæ•´å¤åˆ¶
â”‚   â”œâ”€â”€ package.json     # çœŸå®æ–‡ä»¶
â”‚   â””â”€â”€ index.js         # çœŸå®æ–‡ä»¶
â””â”€â”€ express/             # å®Œæ•´å¤åˆ¶
```

**Workspaces (v7+)**ï¼šâœ… ä½¿ç”¨ç¬¦å·é“¾æ¥

```bash
# package.json
{
  "workspaces": ["packages/*"]
}

# ç»“æœ
node_modules/
â””â”€â”€ pkg-a -> ../packages/pkg-a  # ç¬¦å·é“¾æ¥
```

**npm link**ï¼šâœ… ä½¿ç”¨ç¬¦å·é“¾æ¥

```bash
cd ~/my-lib && npm link
cd ~/my-app && npm link my-lib

# ç»“æœ
node_modules/my-lib -> ~/my-lib  # ç¬¦å·é“¾æ¥
```

### Yarn é“¾æ¥æŠ€æœ¯

**Yarn Classic (v1) å¸¸è§„ä¾èµ–**ï¼šâŒ ä¸ä½¿ç”¨é“¾æ¥ï¼Œ**æ–‡ä»¶å¤åˆ¶**

```
~/.yarn/cache/           # å…¨å±€ç¼“å­˜
â””â”€â”€ lodash-4.17.21.tgz
           â†“
       ã€å¤åˆ¶ã€‘
           â†“
node_modules/lodash/     # ç‹¬ç«‹å‰¯æœ¬ï¼ˆçœŸå®æ–‡ä»¶ï¼‰
```

**Yarn Workspaces**ï¼šâœ… ä½¿ç”¨ç¬¦å·é“¾æ¥

```bash
# package.json
{
  "private": true,
  "workspaces": ["packages/*"]
}

# ç»“æœ
node_modules/
â””â”€â”€ pkg-a -> ../packages/pkg-a  # ç¬¦å·é“¾æ¥
```

**yarn link**ï¼šâœ… ä½¿ç”¨ç¬¦å·é“¾æ¥

```bash
cd ~/my-lib && yarn link
cd ~/my-app && yarn link my-lib

# ç»“æœ
node_modules/my-lib -> ~/my-lib  # ç¬¦å·é“¾æ¥
```

**Yarn Berry (v2+) PnP æ¨¡å¼**ï¼šâš ï¸ ä¸æ˜¯ä¼ ç»Ÿé“¾æ¥

```
project/
â”œâ”€â”€ .yarn/cache/
â”‚   â””â”€â”€ lodash-npm-4.17.21.zip  # Zip æ ¼å¼
â”œâ”€â”€ .pnp.cjs                     # ä¾èµ–æ˜ å°„
â””â”€â”€ æ—  node_modules
```

- é€šè¿‡ JS è¿è¡Œæ—¶æ‹¦æˆªè§£ææ¨¡å—
- ä¸ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿé“¾æ¥

### PNPM é“¾æ¥æŠ€æœ¯

**æ‰€æœ‰ä¾èµ–**ï¼šâœ… ç¡¬é“¾æ¥ + ç¬¦å·é“¾æ¥

#### ç¡¬é“¾æ¥ï¼ˆæ–‡ä»¶çº§åˆ«ï¼‰

```bash
~/.pnpm-store/v3/.../lodash/index.js  (åŸå§‹ï¼Œinode: 12345678)
                â†“
          ã€ç¡¬é“¾æ¥ã€‘
                â†“
project/node_modules/.pnpm/.../index.js  (inode: 12345678)
```

- æŒ‡å‘åŒä¸€ inode
- é›¶ç£ç›˜å ç”¨
- å¤šé¡¹ç›®å…±äº«

#### ç¬¦å·é“¾æ¥ï¼ˆç›®å½•çº§åˆ«ï¼‰

```bash
project/node_modules/lodash
          â†“
    ã€ç¬¦å·é“¾æ¥ã€‘
          â†“
project/node_modules/.pnpm/lodash@4.17.21/node_modules/lodash
```

- æ§åˆ¶è®¿é—®æƒé™
- é˜²æ­¢å¹½çµä¾èµ–

### å®Œæ•´å¯¹æ¯”è¡¨

| åœºæ™¯ | NPM | Yarn Classic | Yarn Berry | PNPM |
|-----|-----|-------------|-----------|------|
| **å¸¸è§„ä¾èµ–** | æ–‡ä»¶å¤åˆ¶ | æ–‡ä»¶å¤åˆ¶ | PnP | ç¡¬é“¾æ¥+ç¬¦å·é“¾æ¥ ğŸ† |
| **Workspaces** | ç¬¦å·é“¾æ¥ | ç¬¦å·é“¾æ¥ | ç¬¦å·é“¾æ¥ | ç¬¦å·é“¾æ¥+ç¡¬é“¾æ¥ |
| **æ‰‹åŠ¨ link** | ç¬¦å·é“¾æ¥ | ç¬¦å·é“¾æ¥ | ç¬¦å·é“¾æ¥ | ç¬¦å·é“¾æ¥ |
| **å…¨å±€å…±äº«** | âŒ | âŒ | âŒ | âœ… |
| **ç£ç›˜å ç”¨ï¼ˆå•é¡¹ç›®ï¼‰** | å¤§ | å¤§ | å° | ä¸­ |
| **ç£ç›˜å ç”¨ï¼ˆå¤šé¡¹ç›®ï¼‰** | å·¨å¤§ | å·¨å¤§ | å° | æå° ğŸ† |
| **å¹½çµä¾èµ–** | å­˜åœ¨ | å­˜åœ¨ | æ—  | æ—  |

### éªŒè¯æ–¹æ³•

```bash
# NPM/Yarn å¸¸è§„ä¾èµ– - æ™®é€šæ–‡ä»¶
ls -l node_modules/lodash/package.json
# -rw-r--r-- ... (ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ -)

# Yarn Workspaces - ç¬¦å·é“¾æ¥
ls -l node_modules/pkg-a
# lrwxr-xr-x ... pkg-a -> ../packages/pkg-a (ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ l)

# PNPM å¸¸è§„ä¾èµ– - ç¬¦å·é“¾æ¥
ls -l node_modules/lodash
# lrwxr-xr-x ... lodash -> .pnpm/... (ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ l)

# PNPM ç¡¬é“¾æ¥æ•°
ls -li node_modules/.pnpm/lodash@4.17.21/.../package.json
# 12345678 ... (ç¬¬äºŒåˆ— > 1 è¯´æ˜æœ‰å¤šä¸ªç¡¬é“¾æ¥)
```

### å…³é”®åŒºåˆ«æ€»ç»“

1. **NPM/Yarn**ï¼š
   - å¸¸è§„ä¾èµ–ï¼šæ–‡ä»¶å¤åˆ¶ï¼ˆæ— é“¾æ¥ï¼‰
   - Workspaces/linkï¼šç¬¦å·é“¾æ¥ï¼ˆä»…æœ¬åœ°åŒ…ï¼‰

2. **PNPM**ï¼š
   - æ‰€æœ‰ä¾èµ–ï¼šç¡¬é“¾æ¥ï¼ˆæ–‡ä»¶ï¼‰+ ç¬¦å·é“¾æ¥ï¼ˆç›®å½•ï¼‰
   - å…¨å±€å…±äº«ï¼ŒèŠ‚çœç©ºé—´

3. **Yarn Berry**ï¼š
   - PnP æ¨¡å¼ï¼šä¸æ˜¯ä¼ ç»Ÿé“¾æ¥ï¼Œæ˜¯ JS è¿è¡Œæ—¶æ‹¦æˆª

**ç»“è®º**ï¼š
- NPM/Yarn åœ¨ **Workspaces å’Œ link åœºæ™¯**ä½¿ç”¨ç¬¦å·é“¾æ¥
- åªæœ‰ PNPM å¯¹**æ‰€æœ‰ä¾èµ–**ä½¿ç”¨ç¡¬é“¾æ¥+ç¬¦å·é“¾æ¥æŠ€æœ¯
- è¿™æ˜¯ PNPM èŠ‚çœç£ç›˜ç©ºé—´ã€è§£å†³å¹½çµä¾èµ–çš„æ ¸å¿ƒåŸå›  ğŸ¯

---

## PNPM åœ¨ Serverless ç¯å¢ƒä¸­çš„éƒ¨ç½²é—®é¢˜

### é—®é¢˜èƒŒæ™¯

PNPM ä½¿ç”¨ç¡¬é“¾æ¥æŠ€æœ¯éœ€è¦æ–‡ä»¶ç³»ç»Ÿæ”¯æŒå’Œç›¸åº”çš„æ“ä½œæƒé™ã€‚åœ¨ä¼ ç»ŸæœåŠ¡å™¨ä¸Šè¿™ä¸æ˜¯é—®é¢˜ï¼Œä½†åœ¨ Serverless ç¯å¢ƒï¼ˆå¦‚ Cloudflare Workersã€AWS Lambdaï¼‰ä¸­å¯èƒ½ä¼šé‡åˆ°é™åˆ¶ã€‚

### Serverless ç¯å¢ƒç‰¹ç‚¹

#### 1. åªè¯»æ–‡ä»¶ç³»ç»Ÿ
å¤§å¤šæ•° Serverless ç¯å¢ƒçš„æ–‡ä»¶ç³»ç»Ÿæ˜¯**åªè¯»**çš„ï¼š

```
AWS Lambda:
  /var/task/          åªè¯»ï¼ˆä»£ç ç›®å½•ï¼‰
  /tmp/               å¯å†™ï¼ˆä¸´æ—¶ï¼Œ500MB é™åˆ¶ï¼‰

Cloudflare Workers:
  å®Œå…¨æ— æ–‡ä»¶ç³»ç»Ÿ        æ‰€æœ‰ä»£ç åœ¨ V8 isolate ä¸­è¿è¡Œ
  ä¸æ”¯æŒ node_modules   å¿…é¡»æ‰“åŒ…æˆå•ä¸ª bundle
```

#### 2. ä¸æ”¯æŒç¬¦å·é“¾æ¥/ç¡¬é“¾æ¥
- éƒ¨ç½²åŒ…é€šå¸¸æ˜¯ ZIP å‹ç¼©æ–‡ä»¶
- ä¸Šä¼ åè§£å‹åˆ°åªè¯»æ–‡ä»¶ç³»ç»Ÿ
- **ç¡¬é“¾æ¥ä¿¡æ¯ä¼šä¸¢å¤±**ï¼ˆå‹ç¼©æ—¶å˜æˆç‹¬ç«‹æ–‡ä»¶ï¼‰
- ç¬¦å·é“¾æ¥å¯èƒ½å˜æˆæ‚¬ç©ºé“¾æ¥æˆ–è¢«è§£ææˆå‰¯æœ¬

### å„å¹³å°å…·ä½“æƒ…å†µ

#### AWS Lambda

**é—®é¢˜**ï¼š
```bash
# æœ¬åœ° PNPM å®‰è£…
node_modules/lodash -> .pnpm/lodash@4.17.21/.../lodash  # ç¬¦å·é“¾æ¥
node_modules/.pnpm/.../index.js  # ç¡¬é“¾æ¥åˆ° store

# æ‰“åŒ…æˆ ZIP
â†’ ç¬¦å·é“¾æ¥è¢«è§£ææˆç›®æ ‡æ–‡ä»¶ï¼ˆæˆ–ä¿ç•™ä¸ºç¬¦å·é“¾æ¥ï¼‰
â†’ ç¡¬é“¾æ¥å˜æˆç‹¬ç«‹æ–‡ä»¶å‰¯æœ¬

# Lambda è§£å‹
â†’ åªè¯»æ–‡ä»¶ç³»ç»Ÿ
â†’ ç¡¬é“¾æ¥ä¼˜åŠ¿ä¸¢å¤±
â†’ æ–‡ä»¶è¢«å¤åˆ¶ï¼Œç©ºé—´ä¼˜åŠ¿æ¶ˆå¤±
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. **ä½¿ç”¨æ‰“åŒ…å·¥å…·**ï¼ˆæ¨èï¼‰â­ï¸
   ```bash
   # ä½¿ç”¨ esbuild/webpack æ‰“åŒ…æˆå•æ–‡ä»¶
   npm install -D esbuild

   # esbuild é…ç½®
   esbuild src/index.ts --bundle --platform=node --target=node18 --outfile=dist/index.js

   # éƒ¨ç½² dist/index.jsï¼Œæ— éœ€ node_modules
   ```

2. **ä½¿ç”¨ serverless-pnpm æ’ä»¶**
   ```bash
   npm install -D serverless-pnpm

   # serverless.yml
   plugins:
     - serverless-pnpm

   # è‡ªåŠ¨å¤„ç† PNPM ä¾èµ–
   ```

3. **éƒ¨ç½²å‰è½¬æ¢ä¸º NPM**
   ```bash
   # æ–¹æ³• 1: åˆ é™¤ PNPM äº§ç‰©ï¼Œç”¨ NPM å®‰è£…
   rm -rf node_modules .pnpm-store pnpm-lock.yaml
   npm install --production

   # æ–¹æ³• 2: ä½¿ç”¨ pnpm deploy
   pnpm deploy --prod --filter=my-lambda ./deploy
   # ä¼šåˆ›å»ºä¸å«ç¬¦å·é“¾æ¥çš„ç‹¬ç«‹å‰¯æœ¬
   ```

4. **ä½¿ç”¨ Lambda Layers**
   ```bash
   # å°†ä¾èµ–æ”¾åˆ° Layer
   mkdir -p layer/nodejs
   cd layer/nodejs
   npm install --production  # ç”¨ NPM å®‰è£…ä¾èµ–
   cd ../..
   zip -r layer.zip layer

   # ä¸Šä¼ ä¸º Lambda Layer
   # å‡½æ•°ä»£ç åªåŒ…å«ä¸šåŠ¡é€»è¾‘
   ```

#### Cloudflare Workers

**æ›´ä¸¥æ ¼çš„é™åˆ¶**ï¼š
- âŒ å®Œå…¨æ— æ–‡ä»¶ç³»ç»Ÿ
- âŒ ä¸æ”¯æŒ `require('fs')`
- âŒ ä¸æ”¯æŒ `node_modules`
- âœ… å¿…é¡»æ‰“åŒ…æˆå•æ–‡ä»¶ ES Module

**è§£å†³æ–¹æ¡ˆ**ï¼š

**åªèƒ½ä½¿ç”¨æ‰“åŒ…å·¥å…·**ï¼ˆæ— å…¶ä»–é€‰æ‹©ï¼‰
```bash
# Wrangler è‡ªåŠ¨ä½¿ç”¨ esbuild æ‰“åŒ…
npx wrangler dev

# wrangler.toml
[build]
command = "pnpm build"

[build.upload]
format = "modules"
main = "./dist/index.mjs"

# package.json
{
  "scripts": {
    "build": "esbuild src/index.ts --bundle --format=esm --outfile=dist/index.mjs"
  }
}
```

**æ³¨æ„**ï¼š
- PNPM åªç”¨äºå¼€å‘ç¯å¢ƒä¾èµ–ç®¡ç†
- éƒ¨ç½²æ—¶æ‰€æœ‰ä»£ç æ‰“åŒ…æˆå•æ–‡ä»¶
- node_modules ä¸ä¼šè¢«ä¸Šä¼ 
- ç¬¦å·é“¾æ¥/ç¡¬é“¾æ¥æ— å½±å“

#### Vercel Edge Functions

ç±»ä¼¼ Cloudflare Workersï¼š
```bash
# è‡ªåŠ¨æ‰“åŒ…ï¼Œæ”¯æŒ PNPM
vercel.json:
{
  "buildCommand": "pnpm build"
}

# è‡ªåŠ¨å¤„ç†ä¾èµ–ï¼Œæ— éœ€æ‹…å¿ƒç¬¦å·é“¾æ¥
```

#### Azure Functions

ç±»ä¼¼ AWS Lambdaï¼Œä½†æ”¯æŒæ›´å¥½ï¼š
```bash
# æ”¯æŒ node_modules éƒ¨ç½²
# æ¨èç”¨æ‰“åŒ…å·¥å…·æˆ–è½¬æ¢ä¸º NPM
```

### æœ€ä½³å®è·µæ€»ç»“

#### 1. **æ¨èæ–¹æ¡ˆï¼šæ‰“åŒ…å·¥å…·** ğŸ†

**é€‚ç”¨äºæ‰€æœ‰ Serverless å¹³å°**

```bash
# 1. å¼€å‘æ—¶ç”¨ PNPMï¼ˆäº«å—é€Ÿåº¦å’Œç©ºé—´ä¼˜åŠ¿ï¼‰
pnpm install
pnpm dev

# 2. éƒ¨ç½²å‰æ‰“åŒ…
esbuild src/index.ts \
  --bundle \
  --platform=node \
  --target=node18 \
  --minify \
  --outfile=dist/index.js

# 3. åªéƒ¨ç½² dist/index.js
# âœ… æ—  node_modules
# âœ… æ— ç¬¦å·é“¾æ¥é—®é¢˜
# âœ… ä½“ç§¯å°ï¼Œå†·å¯åŠ¨å¿«
```

**ä¼˜åŠ¿**ï¼š
- âœ… å®Œå…¨é¿å¼€ç¬¦å·é“¾æ¥é—®é¢˜
- âœ… éƒ¨ç½²åŒ…æ›´å°ï¼ˆtree-shakingï¼‰
- âœ… å†·å¯åŠ¨æ›´å¿«
- âœ… å¼€å‘æ—¶äº«å— PNPM ä¼˜åŠ¿

#### 2. **æ›¿ä»£æ–¹æ¡ˆï¼špnpm deploy**

**é€‚ç”¨äº AWS Lambdaã€Azure Functions**

```bash
# åˆ›å»ºç‹¬ç«‹éƒ¨ç½²ç›®å½•
pnpm deploy --prod --filter=my-function ./deploy-output

# deploy-output/ å†…å®¹ï¼š
# - æ²¡æœ‰ç¬¦å·é“¾æ¥ï¼ˆçœŸå®æ–‡ä»¶ï¼‰
# - åªåŒ…å«ç”Ÿäº§ä¾èµ–
# - å¯ç›´æ¥æ‰“åŒ…ä¸Šä¼ 

cd deploy-output
zip -r ../function.zip .
aws lambda update-function-code --function-name my-func --zip-file fileb://../function.zip
```

#### 3. **æœ€ç®€å•ï¼šåˆ‡æ¢åˆ° NPM éƒ¨ç½²**

```bash
# CI/CD æ„å»ºè„šæœ¬
steps:
  - name: Install dependencies
    run: |
      rm -rf node_modules pnpm-lock.yaml
      npm ci --production

  - name: Deploy
    run: zip -r function.zip . && deploy
```

### å¹³å°å…¼å®¹æ€§é€ŸæŸ¥è¡¨

| å¹³å° | æ–‡ä»¶ç³»ç»Ÿ | node_modules | PNPM ç¬¦å·é“¾æ¥ | æ¨èæ–¹æ¡ˆ |
|------|---------|--------------|--------------|---------|
| **AWS Lambda** | åªè¯» | âœ… æ”¯æŒ | âš ï¸ å˜æˆå‰¯æœ¬ | æ‰“åŒ…/pnpm deploy |
| **Cloudflare Workers** | âŒ æ—  | âŒ ä¸æ”¯æŒ | âŒ ä¸æ”¯æŒ | **å¿…é¡»æ‰“åŒ…** |
| **Vercel Edge** | âŒ æ—  | âŒ ä¸æ”¯æŒ | âŒ ä¸æ”¯æŒ | **è‡ªåŠ¨æ‰“åŒ…** |
| **Vercel Serverless** | åªè¯» | âœ… æ”¯æŒ | âš ï¸ å˜æˆå‰¯æœ¬ | è‡ªåŠ¨å¤„ç†/æ‰“åŒ… |
| **Azure Functions** | åªè¯» | âœ… æ”¯æŒ | âš ï¸ å˜æˆå‰¯æœ¬ | æ‰“åŒ…/NPM |
| **Google Cloud Functions** | åªè¯» | âœ… æ”¯æŒ | âš ï¸ å˜æˆå‰¯æœ¬ | æ‰“åŒ…/NPM |

### æ ¸å¿ƒç»“è®º

1. **PNPM ç¬¦å·é“¾æ¥åœ¨ Serverless ä¸­ä¸æ˜¯è‡´å‘½é—®é¢˜**
   - å¤§å¤šæ•°æƒ…å†µä¼šè‡ªåŠ¨å¤„ç†ï¼ˆå˜æˆå‰¯æœ¬ï¼‰
   - ä¸ä¼šå¯¼è‡´éƒ¨ç½²å¤±è´¥

2. **ä½†ä¼šå¤±å» PNPM çš„ä¼˜åŠ¿**
   - ç¡¬é“¾æ¥ä¿¡æ¯ä¸¢å¤± â†’ ç©ºé—´ä¼˜åŠ¿æ¶ˆå¤±
   - éƒ¨ç½²åŒ…å˜å¤§
   - ä»æœ‰å¹½çµä¾èµ–ä¿æŠ¤

3. **ç°ä»£æœ€ä½³å®è·µï¼šæ‰“åŒ…éƒ¨ç½²**
   - å¼€å‘ç”¨ PNPMï¼ˆå¿«é€Ÿã€èŠ‚çœç©ºé—´ï¼‰
   - éƒ¨ç½²ç”¨æ‰“åŒ…å·¥å…·ï¼ˆå°ä½“ç§¯ã€å¿«å¯åŠ¨ï¼‰
   - å®Œç¾è§£å†³ç¬¦å·é“¾æ¥é—®é¢˜
   - é€‚ç”¨äºæ‰€æœ‰ Serverless å¹³å°

4. **ä»€ä¹ˆæ—¶å€™ç›´æ¥éƒ¨ç½² node_modulesï¼Ÿ**
   - å¤æ‚ä¾èµ–ï¼ˆåŸç”Ÿæ¨¡å—ã€åŠ¨æ€ requireï¼‰
   - å¿«é€ŸåŸå‹å¼€å‘
   - ä½¿ç”¨ Lambda Layers ç®¡ç†ä¾èµ–

### å®é™…æ¡ˆä¾‹

```bash
# é¡¹ç›®ç»“æ„
my-lambda/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ index.ts          # ä¸šåŠ¡ä»£ç 
â”œâ”€â”€ package.json
â”œâ”€â”€ pnpm-lock.yaml
â””â”€â”€ esbuild.config.js

# package.json
{
  "scripts": {
    "dev": "pnpm install && tsx watch src/index.ts",
    "build": "esbuild src/index.ts --bundle --platform=node --target=node18 --outfile=dist/index.js",
    "deploy": "pnpm build && zip -j function.zip dist/index.js && aws lambda update-function-code ..."
  },
  "dependencies": {
    "axios": "^1.6.0"       # è¿è¡Œæ—¶ä¾èµ–
  },
  "devDependencies": {
    "esbuild": "^0.19.0",   # å¼€å‘ä¾èµ–
    "tsx": "^4.0.0"
  }
}

# å¼€å‘ï¼šäº«å— PNPM é€Ÿåº¦
pnpm install  # ç§’è£…
pnpm dev

# éƒ¨ç½²ï¼šå•æ–‡ä»¶ bundle
pnpm build
# â†’ dist/index.js (åŒ…å«æ‰€æœ‰ä¾èµ–ï¼Œ50KB)

# ä¸Šä¼ 
aws lambda update-function-code --function-name my-func --zip-file fileb://function.zip
```

**æ€»ç»“ï¼šåœ¨ Serverless æ—¶ä»£ï¼ŒPNPM çš„ç¬¦å·é“¾æ¥ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºç°ä»£æœ€ä½³å®è·µå°±æ˜¯æ‰“åŒ…éƒ¨ç½²ï¼** ğŸš€
